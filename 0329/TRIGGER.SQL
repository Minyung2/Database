/* TRIGGER 트리거
* 데이터 베이스 특정 동작(이벤트)에 반응하여 실행되는 개체
* 무결성, 자동화 목적
* CREATE OR REPLACE TIRGGER 트리거명
* {BEFORE|AFTER} 이벤트명 {INSERT|UPDATE|DELETE}
* [OF 특정 컬럼]
* ON 테이블명
* [REFERENCEING OLD AS OLD|NEW AS NEW]
* [FOR EACH ROW WHEN 조건절]
* [FOLLOWS]
* [ENABLE|DISABLE]
* 선언부
* 실행부
* END 트리거명
*/
CREATE TABLE EMP_TRIG AS SELECT * FROM EMP;


CREATE OR REPLACE TRIGGER TRIG1
BEFORE INSERT OR UPDATE OR DELETE ON EMP_TRIG
BEGIN 
	IF TO_CHAR(SYSDATE,'DY') IN ('토','일') THEN 
	IF INSERTING THEN 
		RAISE_APPLICATION_ERROR(-20000,'사원 정보 추가 불가');
	ELSIF UPDATING THEN
		RAISE_APPLICATION_ERROR(-20001,'사원 정보 추가 불가');
	ELSIF DELETING THEN
		RAISE_APPLICATION_ERROR(-20002,'사원 정보 삭제 불가');
	ELSE 
		RAISE_	APPLICATION_ERROR(-20003,'사원 정보 추가 불가');
END IF;
END IF;
END;
DROP TRIGGER SCOTT.TRIG1;
ALTER TRIGGER SCOTT.TRIG1 COMPILE;
INSERT INTO EMP_TRIG(EMPNO,ENAME,JOB,MGR,HIREDATE,SAL,DEPTNO) VALUES(8000,'NAME','CLERK',7902,'토',1500,10);
INSERT INTO EMP_TRIG(EMPNO) VALUES(7777);
DELETE FROM EMP_TRIG WHERE EMPNO = 7777;

CREATE TABLE EMP_LOG(
	TABLENAME VARCHAR2(10),
	DML_TPYE VARCHAR2(10),
	EMPNO NUMBER(4),
	USER_NAME VARCHAR2(30),
	CHANGE_DATE DATE
)

CREATE OR REPLACE TRIGGER TRIG2
AFTER DELETE OR INSERT OR UPDATE ON EMP_TRIG
REFERENCING OLD AS O NEW AS N 
BEGIN 
	IF INSERTING THEN INSERT INTO EMP_LOG VALUES('EMP_TRIG','INSERT',:N.EMPNO,SYSCONTEXT('USERENV','SESSION_USER',SYSDATE);
	IF UPDATING THEN INSERT INTO EMP_LOG VALUES('EMP_TRIG','UPDATE',:O.EMPNO,SYSCONTEXT('USERENV','SESSION_USER',SYSDATE);
	IF DELETING THEN INSERT INTO EMP_LOG VALUES('EMP_TRIG','DELETE',:O.EMPNO,SYSCONTEXT('USERENV','SESSION_USER',SYSDATE);
END IF;

